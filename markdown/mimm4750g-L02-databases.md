## Databases

![](https://imgs.xkcd.com/comics/exploits_of_a_mom.png)

---

# What is a database?

* A systematic (structured) collection of data records for the purpose of retrieving records upon a query.
* Sequential storage:
  * Index cards, magnetic tape
  * Exhaustive search, but fast processing of a batch when you reach it
* Random access:
  * Retrieve a record using an index
  * Index has to be built, updated; slower to add new records.

---

# Tables

* A set of related data, where each record is represented by a *row* and each variable (field) appears in a *column*.
* For example:
  
| Key | Last name | Given names | Number of eyes |
|-----|-----------|-------------|----------------|
| 1   | Fry       | Philip J.   | 2              |
| 2   | Leela     | Turanga     | 1              |
| 3   | Rodriguez | Bender Bending | 2           |

---

# Database schema

* A formal model of how data are organized.
* Basically, how fields in different tables are related to each other.
* The defining characteristic of relational databases. 

<img src="/img/schema.png" width="500px"/>

---

# Relational databases

* A [relational database](https://en.wikipedia.org/wiki/Relational_database) is implemented with a *structured query language* (SQL).
* SQL is used to create, update, and query a relational database.
* First developed by IBM in 1980's, based on work by [Ted Codd](https://en.wikipedia.org/wiki/Edgar_F._Codd).
* Later other companies developed commercial implementations of SQL, such as Oracle.
* [MySQL](https://en.wikipedia.org/wiki/MySQL) is an open-source implementation.
* Many languages now support SQL in different ways.

---

# Non-relational databases

* Although relational databases are very common, some agencies dealing with massive amounts of data (*e.g.*, Google, Amazon, Netflix) have adopted a different approach.
* A non-relational database or [NoSQL](https://en.wikipedia.org/wiki/NoSQL) has no fixed database schema - great when database has to adapt to new demands.
* NoSQL allows the addition of new fields in real-time.
* Supports distributed computing (multiple servers/sites).

---

# Querying a database

* `SELECT` is an SQL command that returns one or more fields from records from one or more tables

```
select LAST_NAME from CHARACTERS where NUMBER_OF_EYES is 2
```

```
Fry
Rodriguez
```

---

# Is a spreadsheet application the same as a DMS?

* DMS = [database management system](https://en.wikipedia.org/wiki/Database#Database_management_system).
* A spreadsheet app like MS Excel can store data in a structured format.
* A relational database can be built in Excel using a "master" spreadsheet.
* Performance of Excel does not scale with size of database.
* Database management systems like SQL enable multiple users to query and modify the database -- Excel is a single-user application.

---

# Front- and back-ends

* Most web pages are *dynamic content* - the information that gets displayed in your browser is the result of a database query.
* Other web sites use *static pages* in which web content is generated from plain text files in a specific format such as [HTML](https://en.wikipedia.org/wiki/HTML) or [Markdown](https://en.wikipedia.org/wiki/Markdown).
* Code responsible for database transactions to serve dynamic content take place in the [back end](https://en.wikipedia.org/wiki/Front_and_back_ends).
* The *front end* is what you see: a web interface with forms and other data from which the back-end will compose a query.

---

# Demonstrate a Genbank query

<iframe width="800" height="500" src="https://www.ncbi.nlm.nih.gov/genbank/">
</iframe>

---

# NCBI Short Read Archive

* Genbank mostly comprises sequences generated by [Sanger method](https://en.wikipedia.org/wiki/Sanger_sequencing)
* [Next-generation sequencing](https://en.wikipedia.org/wiki/DNA_sequencing#Next-generation_methods) (NGS) platforms now produce millions of sequences in a single run.
* The SRA stores NGS data - requires special [toolkit](https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software) to download records.
* Data are annotated by:
  * Project metadata (SRP)
  * Experiment (SRX)
  * Run number (SRR)
  * Sample number (SRS)

---

# Demonstrate an SRA query

<iframe width="800" height="500" src="https://www.ncbi.nlm.nih.gov/sra/">
</iframe>

---

# Demonstrate fasterq-dump

![](/img/fasterq-dump.png)

---

# No fasterq-dump for Windows

![](/img/no-fasterq-for-win.png)

---

# Emerging infectious diseases

<iframe width="800" height="500" src="https://eidr.ecohealthalliance.org/">
</iframe>

---

# In-class assignment

1. Select an interesting outbreak from the EID database

2. Query Genbank for this pathogen.  Use the taxonomy browser (right column) to refine your query.
   
3. How many hits did you find?  

4. What is the accession number and description for the first hit?

---

# Further readings:
* [Early History of SQL](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=6359709)
* [Understanding SRA Search Results](https://www.ncbi.nlm.nih.gov/books/NBK56913/)

